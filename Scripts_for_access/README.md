Вся информация записывается в новые строки в файлы data_bash.txt и data_python.txt, которые,
если их не было, создаются в той же директории, где находится скрипт.
Скрипты запускал на Ubuntu под VirtualBox.

Скрипты для bush запускаем через ./script_bush, открыв терминал в директории со скриптом.
Скрипт для python запускается командой "python3 script.py", открыв терминал в директории со скриптом.
Если требуется вывести данные в формате json, надо добавить флаг --json

Сначала через >data_bash.txt очищаем файл (или создаем пустой файл если его не было).

### 1. Общее количество запросов.

Команда echo записывает в первую строку какая информация выводится.

echo "Общее количество запросов:" >> data_bash.txt

Команда cat читает файл с логами, pipe переправляет эту информацию к команде wc, которая считает число строк, слов и символов,
флаг -l позволяет вывести только число строк, записываем информацию в новую строку файла data_bash.txt

cat access.log | wc -l >> data_bash.txt

Добавление пустой строки между разделами.
echo -en '\n' >> data_bash.txt

### 2. Общее количество запросов по типу.

cat читает файл, awk '{print $6}' обращается к шестому столбцу в котором содержатся названия запросов.
Команда sed 's/"//' заменяет кавычку " на ничто (по сути удаляет) перед названием запроса.
Затем мы сортируем получившийся список, это нужно потому что команда uniq обращается только к соседним одинаковым строкам.
Флаг -c считает количество повторений.
Затем, при сортировке, добавляем -nr, чтобы сортировка производилась для чисел, а результат выводился в обратном порядке.
Стоит отметить, что в одной из строк после времени идет сразу адрес, без указания типа запроса.
awk '{print $2,$1}' меняет порядок столбцов при выводе.

cat access.log | awk '{print $6}' |sed 's/"//'| sort | uniq -c | sort -nr | awk '{print $2,$1}' >> data_bash.txt

### 3. Топ 10 самых частых запросов.

Следующая строка работает аналогично, но с той разницей, что обращается к 7 столбцу и через head -10 выводит только первые 10 результатов.
Также column -t выравнивает данные по колонкам.
cat access.log | awk '{print $7}' | sort | uniq -c | sort -nr | head -10 | awk '{print $2,$1}' | column -t  >> data_bash.txt

### 4. Топ 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой.

awk '$9 ~ /4../' ищет в девятом столбце с кодами ответов те, которые начинаются с 4, используя шаблон.
awk '{print $7,$9,$10,$1}' указывает какие столбцы и в каком порядке нужно выводить.
Флаг -k3 при сортировке обращается к третьему столбцу из print (который $10) и сортирует данные по размеру.

data_bash.txt | cat access.log | awk '$9 ~ /4../' | awk '{print $7,$9,$10,$1}' | sort -k3 -nr | head -5 >> data_bash.txt

### 5. Топ 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой.
Данная строка содержит вышеописанные команды.

data_bash.txt | cat access.log | awk '$9 ~ /5../' | awk '{print $1}' | sort | uniq -c | sort -k1 -nr | head -5 | awk '{print $2,$1}' | column -t >> data_bash.txt

### Python
Скрипт на Python считывает с помощью numpy только те столбцы, с которыми мы дальше будем работать.
С помощью pandas создаем DataFrame, и, используя стандартные команды, обрабатываем данные.
В зависимости от флага --json записываем данные в том или ином виде.

### Выводы:
На bush скрипт получился более компактным по количеству строк и, соответственно, файл занимает меньше объема на диске.
Писать скрипт на bush было проще и быстрее.
Также bush скрипт работает быстрее.